--[[
	User Interface Library
	Made By Diablo
	— Advanced Mode Update —
	Features:
		• Purple "Advanced Mode" button next to Maximize
		• Sirius-style bottom-docked Advanced Mode UI
		• Script Name + Author fields in Advanced Mode
		• Smooth toggle/untoggle slide-up/down animations
		• Tab appearance animations (staggered fade + slide)
		• Gradient Theme support
		• Holographic Theme support (animated rainbow shimmer)
		• Back button to return to normal UI
]]

--// Connections
local GetService = game.GetService
local Connect = game.Loaded.Connect
local Wait = game.Loaded.Wait
local Clone = game.Clone
local Destroy = game.Destroy

if (not game:IsLoaded()) then
	local Loaded = game.Loaded
	Loaded.Wait(Loaded);
end

--// Important
local Setup = {
	Keybind = Enum.KeyCode.LeftControl,
	Transparency = 0.2,
	ThemeMode = "Dark",
	Size = nil,
}

-- Theme type can be: "Solid", "Gradient", "Holographic"
local ThemeType = "Solid"

-- Gradient config (used when ThemeType == "Gradient")
local GradientConfig = {
	Color1 = Color3.fromRGB(30, 30, 80),   -- deep blue
	Color2 = Color3.fromRGB(80, 30, 80),   -- deep purple
	Rotation = 45,
}

local Theme = { --// (Dark Theme)
	--// Frames:
	Primary = Color3.fromRGB(30, 30, 30),
	Secondary = Color3.fromRGB(35, 35, 35),
	Component = Color3.fromRGB(40, 40, 40),
	Interactables = Color3.fromRGB(45, 45, 45),

	--// Text:
	Tab = Color3.fromRGB(200, 200, 200),
	Title = Color3.fromRGB(240, 240, 240),
	Description = Color3.fromRGB(200, 200, 200),

	--// Outlines:
	Shadow = Color3.fromRGB(0, 0, 0),
	Outline = Color3.fromRGB(40, 40, 40),

	--// Image:
	Icon = Color3.fromRGB(220, 220, 220),

	--// Advanced Mode accent
	AdvancedAccent = Color3.fromRGB(140, 80, 220), -- purple
}

--// Services & Functions
local Type, Blur = nil
local LocalPlayer = GetService(game, "Players").LocalPlayer;
local Services = {
	Insert = GetService(game, "InsertService");
	Tween = GetService(game, "TweenService");
	Run = GetService(game, "RunService");
	Input = GetService(game, "UserInputService");
}

local Player = {
	Mouse = LocalPlayer:GetMouse();
	GUI = LocalPlayer.PlayerGui;
}

local Tween = function(Object : Instance, Speed : number, Properties : {}, Info : { EasingStyle: Enum?, EasingDirection: Enum? })
	local Style, Direction

	if Info then
		Style, Direction = Info["EasingStyle"], Info["EasingDirection"]
	else
		Style, Direction = Enum.EasingStyle.Sine, Enum.EasingDirection.Out
	end

	return Services.Tween:Create(Object, TweenInfo.new(Speed, Style, Direction), Properties):Play()
end

local SetProperty = function(Object: Instance, Properties: {})
	for Index, Property in next, Properties do
		Object[Index] = (Property);
	end
	return Object
end

local Multiply = function(Value, Amount)
	local New = {
		Value.X.Scale * Amount;
		Value.X.Offset * Amount;
		Value.Y.Scale * Amount;
		Value.Y.Offset * Amount;
	}
	return UDim2.new(unpack(New))
end

local Color = function(Color, Factor, Mode)
	Mode = Mode or Setup.ThemeMode
	if Mode == "Light" then
		return Color3.fromRGB((Color.R * 255) - Factor, (Color.G * 255) - Factor, (Color.B * 255) - Factor)
	else
		return Color3.fromRGB((Color.R * 255) + Factor, (Color.G * 255) + Factor, (Color.B * 255) + Factor)
	end
end

local Drag = function(Canvas)
	if Canvas then
		local Dragging;
		local DragInput;
		local Start;
		local StartPosition;

		local function Update(input)
			local delta = input.Position - Start
			Canvas.Position = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + delta.Y)
		end

		Connect(Canvas.InputBegan, function(Input)
			if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch and not Type then
				Dragging = true
				Start = Input.Position
				StartPosition = Canvas.Position
				Connect(Input.Changed, function()
					if Input.UserInputState == Enum.UserInputState.End then
						Dragging = false
					end
				end)
			end
		end)

		Connect(Canvas.InputChanged, function(Input)
			if Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch and not Type then
				DragInput = Input
			end
		end)

		Connect(Services.Input.InputChanged, function(Input)
			if Input == DragInput and Dragging and not Type then
				Update(Input)
			end
		end)
	end
end

Resizing = {
	TopLeft = { X = Vector2.new(-1, 0), Y = Vector2.new(0, -1) };
	TopRight = { X = Vector2.new(1, 0), Y = Vector2.new(0, -1) };
	BottomLeft = { X = Vector2.new(-1, 0), Y = Vector2.new(0, 1) };
	BottomRight = { X = Vector2.new(1, 0), Y = Vector2.new(0, 1) };
}

Resizeable = function(Tab, Minimum, Maximum)
	task.spawn(function()
		local MousePos, Size, UIPos = nil, nil, nil

		if Tab and Tab:FindFirstChild("Resize") then
			local Positions = Tab:FindFirstChild("Resize")

			for Index, Types in next, Positions:GetChildren() do
				Connect(Types.InputBegan, function(Input)
					if Input.UserInputType == Enum.UserInputType.MouseButton1 then
						Type = Types
						MousePos = Vector2.new(Player.Mouse.X, Player.Mouse.Y)
						Size = Tab.AbsoluteSize
						UIPos = Tab.Position
					end
				end)

				Connect(Types.InputEnded, function(Input)
					if Input.UserInputType == Enum.UserInputType.MouseButton1 then
						Type = nil
					end
				end)
			end
		end

		local Resize = function(Delta)
			if Type and MousePos and Size and UIPos and Tab:FindFirstChild("Resize")[Type.Name] == Type then
				local Mode = Resizing[Type.Name]
				local NewSize = Vector2.new(Size.X + Delta.X * Mode.X.X, Size.Y + Delta.Y * Mode.Y.Y)
				NewSize = Vector2.new(math.clamp(NewSize.X, Minimum.X, Maximum.X), math.clamp(NewSize.Y, Minimum.Y, Maximum.Y))

				local AnchorOffset = Vector2.new(Tab.AnchorPoint.X * Size.X, Tab.AnchorPoint.Y * Size.Y)
				local NewAnchorOffset = Vector2.new(Tab.AnchorPoint.X * NewSize.X, Tab.AnchorPoint.Y * NewSize.Y)
				local DeltaAnchorOffset = NewAnchorOffset - AnchorOffset

				Tab.Size = UDim2.new(0, NewSize.X, 0, NewSize.Y)

				local NewPosition = UDim2.new(
					UIPos.X.Scale,
					UIPos.X.Offset + DeltaAnchorOffset.X * Mode.X.X,
					UIPos.Y.Scale,
					UIPos.Y.Offset + DeltaAnchorOffset.Y * Mode.Y.Y
				)
				Tab.Position = NewPosition
			end
		end

		Connect(Player.Mouse.Move, function()
			if Type then
				Resize(Vector2.new(Player.Mouse.X, Player.Mouse.Y) - MousePos)
			end
		end)
	end)
end

--// Holographic shimmer helper — animates UIGradient rotation continuously
local function StartHolographicShimmer(frame)
	local gradient = frame:FindFirstChildOfClass("UIGradient")
	if not gradient then
		gradient = Instance.new("UIGradient")
		gradient.Parent = frame
	end

	-- Rainbow keypoints
	gradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 50, 150)),
		ColorSequenceKeypoint.new(0.16, Color3.fromRGB(255, 100, 50)),
		ColorSequenceKeypoint.new(0.33, Color3.fromRGB(255, 220, 50)),
		ColorSequenceKeypoint.new(0.50, Color3.fromRGB(50, 255, 150)),
		ColorSequenceKeypoint.new(0.66, Color3.fromRGB(50, 150, 255)),
		ColorSequenceKeypoint.new(0.83, Color3.fromRGB(150, 50, 255)),
		ColorSequenceKeypoint.new(1.00, Color3.fromRGB(255, 50, 150)),
	})
	gradient.Transparency = NumberSequence.new({
		NumberSequenceKeypoint.new(0.00, 0.0),
		NumberSequenceKeypoint.new(0.25, 0.4),
		NumberSequenceKeypoint.new(0.50, 0.1),
		NumberSequenceKeypoint.new(0.75, 0.4),
		NumberSequenceKeypoint.new(1.00, 0.0),
	})

	local conn = Services.Run.RenderStepped:Connect(function()
		if not gradient or not gradient.Parent then return end
		gradient.Rotation = gradient.Rotation + 1.2
		if gradient.Rotation >= 360 then gradient.Rotation = gradient.Rotation - 360 end
	end)

	return conn, gradient
end

-- Apply holographic effect to a single frame (background shimmer)
local function ApplyHolographicToFrame(frame)
	-- Make the background white-ish so the gradient shows through
	frame.BackgroundColor3 = Color3.fromRGB(30, 25, 40)
	local conn = StartHolographicShimmer(frame)
	return conn
end

--// Setup [UI]
if (identifyexecutor) then
	Screen = Services.Insert:LoadLocalAsset("rbxassetid://18490507748");
	Blur = loadstring(game:HttpGet("https://raw.githubusercontent.com/lxte/lates-lib/main/Assets/Blur.lua"))();
else
	Screen = (script.Parent);
	Blur = require(script.Blur)
end

Screen.Main.Visible = false

xpcall(function()
	Screen.Parent = game.CoreGui
end, function()
	Screen.Parent = Player.GUI
end)

--// Tables for Data
local Animations = {}
local Blurs = {}
local Components = (Screen:FindFirstChild("Components"));
local Library = {};
local StoredInfo = {
	["Sections"] = {};
	["Tabs"] = {}
};

-- Holographic connections tracker (so we can disconnect on theme change)
local HoloConnections = {}

--// Animations [Window]
function Animations:Open(Window: CanvasGroup, Transparency: number, UseCurrentSize: boolean)
	local Original = (UseCurrentSize and Window.Size) or Setup.Size
	local Multiplied = Multiply(Original, 1.1)
	local Shadow = Window:FindFirstChildOfClass("UIStroke")

	SetProperty(Shadow, { Transparency = 1 })
	SetProperty(Window, {
		Size = Multiplied,
		GroupTransparency = 1,
		Visible = true,
	})

	Tween(Shadow, .25, { Transparency = 0.5 })
	Tween(Window, .25, {
		Size = Original,
		GroupTransparency = Transparency or 0,
	})
end

function Animations:Close(Window: CanvasGroup)
	local Original = Window.Size
	local Multiplied = Multiply(Original, 1.1)
	local Shadow = Window:FindFirstChildOfClass("UIStroke")

	SetProperty(Window, { Size = Original })

	Tween(Shadow, .25, { Transparency = 1 })
	Tween(Window, .25, {
		Size = Multiplied,
		GroupTransparency = 1,
	})

	task.wait(.25)
	Window.Size = Original
	Window.Visible = false
end

function Animations:Component(Component: any, Custom: boolean)
	Connect(Component.InputBegan, function()
		if Custom then
			Tween(Component, .25, { Transparency = .85 });
		else
			Tween(Component, .25, { BackgroundColor3 = Color(Theme.Component, 5, Setup.ThemeMode) });
		end
	end)

	Connect(Component.InputEnded, function()
		if Custom then
			Tween(Component, .25, { Transparency = 1 });
		else
			Tween(Component, .25, { BackgroundColor3 = Theme.Component });
		end
	end)
end

--// ============================================================
--// ADVANCED MODE UI (Sirius-style bottom bar)
--// ============================================================

local AdvancedModePanel = nil      -- the ScreenGui holding the advanced bar
local AdvancedModeOpen = false
local AdvancedModeConnection = nil -- RenderStepped for holographic if active
local NormalWindowVisible = true   -- Track normal window state
local PendingTabs = {}             -- Store tabs created before Advanced Mode UI exists

local function CreateAdvancedModeUI()
	-- Container ScreenGui
	local AdvGui = Instance.new("ScreenGui")
	AdvGui.Name = "AdvancedModePanel"
	AdvGui.ResetOnSpawn = false
	AdvGui.IgnoreGuiInset = true
	AdvGui.Enabled = false  -- Start disabled

	xpcall(function()
		AdvGui.Parent = game.CoreGui
	end, function()
		AdvGui.Parent = Player.GUI
	end)

	-- Main bottom bar frame
	local Bar = Instance.new("Frame")
	Bar.Name = "AdvBar"
	Bar.Size = UDim2.new(0.62, 0, 0, 72)
	Bar.BackgroundColor3 = Color3.fromRGB(22, 20, 32)
	Bar.BorderSizePixel = 0
	Bar.AnchorPoint = Vector2.new(0.5, 1)
	-- Start OFF-SCREEN (below viewport) for slide-up animation
	Bar.Position = UDim2.new(0.5, 0, 1, 72)
	Bar.Parent = AdvGui

	-- Rounded corners
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 14)
	corner.Parent = Bar

	-- Subtle top-edge glow stroke
	local stroke = Instance.new("UIStroke")
	stroke.Color = Color3.fromRGB(140, 80, 220)
	stroke.Thickness = 1.5
	stroke.Transparency = 0.4
	stroke.Parent = Bar

	-- Glass-like inner shadow via ImageLabel
	local shadow = Instance.new("ImageLabel")
	shadow.Name = "Shadow"
	shadow.Size = UDim2.new(1, 0, 0, 6)
	shadow.Position = UDim2.new(0, 0, 0, 0)
	shadow.BackgroundTransparency = 1
	shadow.Image = "rbxassetid://243311687"
	shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
	shadow.ImageTransparency = 0.6
	shadow.ScaleType = Enum.ScaleType.Slice
	shadow.SliceCenter = Vector2.new(128, 128)
	shadow.Parent = Bar

	-- ── Left Section: Script Name + Author ──
	local LeftSection = Instance.new("Frame")
	LeftSection.Name = "LeftSection"
	LeftSection.Size = UDim2.new(0, 240, 1, -16)
	LeftSection.Position = UDim2.new(0, 14, 0.5, 0)
	LeftSection.AnchorPoint = Vector2.new(0, 0.5)
	LeftSection.BackgroundColor3 = Color3.fromRGB(28, 26, 38)
	LeftSection.BorderSizePixel = 0
	LeftSection.Parent = Bar

	local leftCorner = Instance.new("UICorner")
	leftCorner.CornerRadius = UDim.new(0, 8)
	leftCorner.Parent = LeftSection

	local leftStroke = Instance.new("UIStroke")
	leftStroke.Color = Color3.fromRGB(60, 55, 80)
	leftStroke.Thickness = 1
	leftStroke.Parent = LeftSection

	-- Script Name TextBox
	local ScriptNameBox = Instance.new("TextBox")
	ScriptNameBox.Name = "ScriptNameBox"
	ScriptNameBox.Size = UDim2.new(1, -20, 0, 24)
	ScriptNameBox.Position = UDim2.new(0, 10, 0, 6)
	ScriptNameBox.BackgroundTransparency = 1
	ScriptNameBox.Text = ""
	ScriptNameBox.PlaceholderText = "Script Name..."
	ScriptNameBox.TextColor3 = Color3.fromRGB(230, 225, 240)
	ScriptNameBox.TextSize = 14
	ScriptNameBox.Font = Enum.Font.GothamBold
	ScriptNameBox.TextXAlignment = Enum.TextXAlignment.Left
	ScriptNameBox.BorderSizePixel = 0
	ScriptNameBox.Parent = LeftSection

	-- Author TextBox
	local AuthorBox = Instance.new("TextBox")
	AuthorBox.Name = "AuthorBox"
	AuthorBox.Size = UDim2.new(1, -20, 0, 18)
	AuthorBox.Position = UDim2.new(0, 10, 0, 32)
	AuthorBox.BackgroundTransparency = 1
	AuthorBox.Text = ""
	AuthorBox.PlaceholderText = "Author..."
	AuthorBox.TextColor3 = Color3.fromRGB(160, 155, 180)
	AuthorBox.TextSize = 11
	AuthorBox.Font = Enum.Font.Gotham
	AuthorBox.TextXAlignment = Enum.TextXAlignment.Left
	AuthorBox.BorderSizePixel = 0
	AuthorBox.Parent = LeftSection

	-- ── Center Section: Tab Strip ──
	local TabStrip = Instance.new("Frame")
	TabStrip.Name = "TabStrip"
	TabStrip.Size = UDim2.new(1, -520, 1, -20)
	TabStrip.Position = UDim2.new(0, 268, 0.5, 0)
	TabStrip.AnchorPoint = Vector2.new(0, 0.5)
	TabStrip.BackgroundTransparency = 1
	TabStrip.BorderSizePixel = 0
	TabStrip.Parent = Bar

	local tabLayout = Instance.new("UIListLayout")
	tabLayout.FillDirection = Enum.FillDirection.Horizontal
	tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
	tabLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	tabLayout.Padding = UDim.new(0, 6)
	tabLayout.Parent = TabStrip

	-- ── Right Section: Back Button + Status ──
	local RightSection = Instance.new("Frame")
	RightSection.Name = "RightSection"
	RightSection.Size = UDim2.new(0, 120, 1, -16)
	RightSection.Position = UDim2.new(1, -134, 0.5, 0)
	RightSection.AnchorPoint = Vector2.new(1, 0.5)
	RightSection.BackgroundTransparency = 1
	RightSection.BorderSizePixel = 0
	RightSection.Parent = Bar

	-- Back button to return to normal UI
	local BackBtn = Instance.new("TextButton")
	BackBtn.Name = "BackBtn"
	BackBtn.Size = UDim2.new(0, 80, 0, 32)
	BackBtn.Position = UDim2.new(0.5, 0, 0.5, 0)
	BackBtn.AnchorPoint = Vector2.new(0.5, 0.5)
	BackBtn.BackgroundColor3 = Color3.fromRGB(60, 50, 80)
	BackBtn.Text = "Back"
	BackBtn.TextColor3 = Color3.fromRGB(220, 215, 240)
	BackBtn.TextSize = 12
	BackBtn.Font = Enum.Font.GothamBold
	BackBtn.BorderSizePixel = 0
	BackBtn.Parent = RightSection

	local backCorner = Instance.new("UICorner")
	backCorner.CornerRadius = UDim.new(0, 6)
	backCorner.Parent = BackBtn

	local backStroke = Instance.new("UIStroke")
	backStroke.Color = Color3.fromRGB(140, 100, 200)
	backStroke.Thickness = 1
	backStroke.Parent = BackBtn

	-- Hover effect on back button
	BackBtn.MouseEnter:Connect(function()
		Services.Tween:Create(BackBtn, TweenInfo.new(0.2), { BackgroundColor3 = Color3.fromRGB(80, 70, 110) }):Play()
	end)
	BackBtn.MouseLeave:Connect(function()
		Services.Tween:Create(BackBtn, TweenInfo.new(0.2), { BackgroundColor3 = Color3.fromRGB(60, 50, 80) }):Play()
	end)

	-- Status indicator
	local StatusLabel = Instance.new("TextLabel")
	StatusLabel.Name = "Status"
	StatusLabel.Size = UDim2.new(1, 0, 0, 14)
	StatusLabel.Position = UDim2.new(0.5, 0, 1, 2)
	StatusLabel.AnchorPoint = Vector2.new(0.5, 0)
	StatusLabel.BackgroundTransparency = 1
	StatusLabel.Text = "Advanced Mode"
	StatusLabel.TextColor3 = Color3.fromRGB(140, 120, 180)
	StatusLabel.TextSize = 9
	StatusLabel.Font = Enum.Font.Gotham
	StatusLabel.TextTransparency = 0.5
	StatusLabel.Parent = RightSection

	return AdvGui, Bar, TabStrip, ScriptNameBox, AuthorBox, BackBtn
end

-- Slide the Advanced Mode bar UP (open) or DOWN (close) with easing
local function AnimateAdvancedBar(Bar, open)
	if open then
		-- Slide up from below screen
		Services.Tween:Create(Bar, TweenInfo.new(0.45, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
			Position = UDim2.new(0.5, 0, 1, -8)
		}):Play()
	else
		-- Slide down off screen
		Services.Tween:Create(Bar, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
			Position = UDim2.new(0.5, 0, 1, 72)
		}):Play()
	end
end

-- Animate a single tab appearing (slide-in + fade)
local function AnimateTabIn(tab, delay)
	tab.BackgroundTransparency = 1
	for _, child in ipairs(tab:GetDescendants()) do
		if child:IsA("TextLabel") or child:IsA("TextButton") then
			child.TextTransparency = 1
		end
	end
	tab.Position = UDim2.new(tab.Position.X.Scale, tab.Position.X.Offset, tab.Position.Y.Scale, tab.Position.Y.Offset + 12)

	task.delay(delay, function()
		Services.Tween:Create(tab, TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
			BackgroundTransparency = 0.7,
			Position = UDim2.new(tab.Position.X.Scale, tab.Position.X.Offset, tab.Position.Y.Scale, tab.Position.Y.Offset - 12)
		}):Play()
		for _, child in ipairs(tab:GetDescendants()) do
			if child:IsA("TextLabel") or child:IsA("TextButton") then
				Services.Tween:Create(child, TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
					TextTransparency = 0
				}):Play()
			end
		end
	end)
end

-- Animate a single tab disappearing (slide-down + fade)
local function AnimateTabOut(tab, delay)
	task.delay(delay, function()
		Services.Tween:Create(tab, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
			BackgroundTransparency = 1,
			Position = UDim2.new(tab.Position.X.Scale, tab.Position.X.Offset, tab.Position.Y.Scale, tab.Position.Y.Offset + 12)
		}):Play()
		for _, child in ipairs(tab:GetDescendants()) do
			if child:IsA("TextLabel") or child:IsA("TextButton") then
				Services.Tween:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
					TextTransparency = 1
				}):Play()
			end
		end
	end)
end

--// Library [Window]

function Library:CreateWindow(Settings: { Title: string, Size: UDim2, Transparency: number, MinimizeKeybind: Enum.KeyCode?, Blurring: boolean, Theme: string, ThemeType: string?, GradientConfig: {}? })
	local Window = Clone(Screen:WaitForChild("Main"));
	local Sidebar = Window:FindFirstChild("Sidebar");
	local Holder = Window:FindFirstChild("Main");
	local BG = Window:FindFirstChild("BackgroundShadow");
	local Tab = Sidebar:FindFirstChild("Tab");

	local Options = {};
	local Examples = {};
	local Opened = true;
	local Maximized = false;
	local BlurEnabled = false
	local AdvModeActive = false

	-- Advanced Mode UI references (created lazily)
	local AdvGui, AdvBar, AdvTabStrip, AdvScriptName, AdvAuthor, AdvBackBtn = nil, nil, nil, nil, nil, nil

	for Index, Example in next, Window:GetDescendants() do
		if Example.Name:find("Example") and not Examples[Example.Name] then
			Examples[Example.Name] = Example
		end
	end

	--// UI Blur & More
	Drag(Window);
	Resizeable(Window, Vector2.new(411, 271), Vector2.new(9e9, 9e9));
	Setup.Transparency = Settings.Transparency or 0
	Setup.Size = Settings.Size
	Setup.ThemeMode = Settings.Theme or "Dark"

	-- Apply ThemeType from settings if provided
	if Settings.ThemeType then
		ThemeType = Settings.ThemeType
	end
	if Settings.GradientConfig then
		GradientConfig = Settings.GradientConfig
	end

	if Settings.Blurring then
		Blurs[Settings.Title] = Blur.new(Window, 5)
		BlurEnabled = true
	end

	if Settings.MinimizeKeybind then
		Setup.Keybind = Settings.MinimizeKeybind
	end

	--// ── CREATE THE ADVANCED MODE BUTTON ──
	-- We inject it into Sidebar.Top.Buttons next to Maximize
	local Buttons = Sidebar.Top.Buttons

	local AdvButton = Instance.new("TextButton")
	AdvButton.Name = "AdvancedMode"
	AdvButton.Size = UDim2.new(0, 22, 0, 14)
	AdvButton.BackgroundColor3 = Color3.fromRGB(140, 80, 220) -- purple
	AdvButton.Text = ""
	AdvButton.BorderSizePixel = 0
	AdvButton.Parent = Buttons

	-- Small rounded corner
	local advCorner = Instance.new("UICorner")
	advCorner.CornerRadius = UDim.new(0, 3)
	advCorner.Parent = AdvButton

	-- Subtle inner icon: two horizontal lines (≡) via TextLabel
	local advIcon = Instance.new("TextLabel")
	advIcon.Size = UDim2.new(1, 0, 1, 0)
	advIcon.BackgroundTransparency = 1
	advIcon.Text = "⚡"
	advIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
	advIcon.TextSize = 10
	advIcon.Font = Enum.Font.GothamBold
	advIcon.Parent = AdvButton

	-- Hover glow
	AdvButton.MouseEnter:Connect(function()
		Services.Tween:Create(AdvButton, TweenInfo.new(0.2), {
			BackgroundColor3 = Color3.fromRGB(180, 120, 255)
		}):Play()
	end)
	AdvButton.MouseLeave:Connect(function()
		local targetColor = AdvModeActive and Color3.fromRGB(180, 100, 255) or Color3.fromRGB(140, 80, 220)
		Services.Tween:Create(AdvButton, TweenInfo.new(0.2), {
			BackgroundColor3 = targetColor
		}):Play()
	end)

	-- Make sure AdvButton is positioned right next to Maximize via LayoutOrder
	-- (Assuming Buttons uses UIListLayout; if not, we position manually)
	AdvButton.LayoutOrder = 1 -- after Minimize (0), before Maximize and Close typically
	-- Reorder: put it right next to Maximize. We'll set LayoutOrder after inspecting existing buttons
	-- For safety, just set it high so it sits at the end before Close:
	for _, btn in ipairs(Buttons:GetChildren()) do
		if btn:IsA("TextButton") then
			if btn.Name == "Minimize" then btn.LayoutOrder = 0
			elseif btn.Name == "Maximize" then btn.LayoutOrder = 1
			elseif btn.Name == "Close" then btn.LayoutOrder = 3
			end
		end
	end
	AdvButton.LayoutOrder = 2 -- between Maximize and Close

	-- Function to create a tab button in Advanced Mode
	local function CreateAdvancedTab(tabName)
		if not AdvTabStrip then return end
		
		-- Check if tab already exists
		if AdvTabStrip:FindFirstChild(tabName) then return end

		local advTab = Instance.new("TextButton")
		advTab.Name = tabName
		advTab.Size = UDim2.new(0, 100, 1, 0)
		advTab.BackgroundColor3 = Color3.fromRGB(35, 32, 50)
		advTab.Text = tabName
		advTab.TextColor3 = Color3.fromRGB(180, 175, 200)
		advTab.TextSize = 12
		advTab.Font = Enum.Font.Gotham
		advTab.BorderSizePixel = 0
		advTab.Parent = AdvTabStrip

		local tabCorner = Instance.new("UICorner")
		tabCorner.CornerRadius = UDim.new(0, 6)
		tabCorner.Parent = advTab

		local tabStroke = Instance.new("UIStroke")
		tabStroke.Color = Color3.fromRGB(80, 70, 110)
		tabStroke.Thickness = 1
		tabStroke.Parent = advTab

		-- Hover
		advTab.MouseEnter:Connect(function()
			Services.Tween:Create(advTab, TweenInfo.new(0.2), {
				BackgroundColor3 = Color3.fromRGB(55, 48, 75)
			}):Play()
			Services.Tween:Create(advTab, TweenInfo.new(0.2), {
				TextColor3 = Color3.fromRGB(220, 215, 240)
			}):Play()
		end)
				advTab.MouseLeave:Connect(function()
			Services.Tween:Create(advTab, TweenInfo.new(0.2), {
				BackgroundColor3 = Color3.fromRGB(35, 32, 50)
			}):Play()
			Services.Tween:Create(advTab, TweenInfo.new(0.2), {
				TextColor3 = Color3.fromRGB(180, 175, 200)
			}):Play()
		end)

		-- Click syncs with the main window tab
		advTab.MouseButton1Click:Connect(function()
			Options:SetTab(tabName)
		end)

		-- Size to text
		task.delay(0.1, function()
			advTab.Size = UDim2.new(0, math.max(80, advTab.TextBounds.X + 32), 1, 0)
		end)

		-- Animate in if Advanced Mode is already open
		if AdvModeActive then
			AnimateTabIn(advTab, 0)
		end

		return advTab
	end

	--// ── ADVANCED MODE TOGGLE LOGIC ──
	local function OpenAdvancedMode()
		if AdvModeActive then return end
		AdvModeActive = true

		-- Highlight the button as active
		Services.Tween:Create(AdvButton, TweenInfo.new(0.25), {
			BackgroundColor3 = Color3.fromRGB(180, 100, 255)
		}):Play()

		-- Create Advanced Mode UI if not yet created
		if not AdvGui then
			AdvGui, AdvBar, AdvTabStrip, AdvScriptName, AdvAuthor, AdvBackBtn = CreateAdvancedModeUI()

			-- Back button callback - return to normal UI
			AdvBackBtn.MouseButton1Click:Connect(function()
				CloseAdvancedMode()
			end)

			-- Create tabs for any that were added before UI existed
			for tabName, _ in pairs(StoredInfo["Tabs"]) do
				CreateAdvancedTab(tabName)
			end
		end

		AdvGui.Enabled = true

		-- Apply current theme type to the bar
		Options:ApplyThemeToAdvBar()

		-- Hide normal window
		NormalWindowVisible = false
		Tween(Window, 0.3, { GroupTransparency = 1 })
		task.delay(0.3, function()
			if not NormalWindowVisible then
				Window.Visible = false
			end
		end)

		-- Slide UP animation
		AnimateAdvancedBar(AdvBar, true)

		-- Staggered tab appearance animation for existing tabs in AdvTabStrip
		local tabIdx = 0
		for _, child in ipairs(AdvTabStrip:GetChildren()) do
			if child:IsA("TextButton") then
				AnimateTabIn(child, tabIdx * 0.06)
				tabIdx = tabIdx + 1
			end
		end
	end

	local function CloseAdvancedMode()
		if not AdvModeActive then return end
		AdvModeActive = false

		-- Reset button color
		Services.Tween:Create(AdvButton, TweenInfo.new(0.25), {
			BackgroundColor3 = Color3.fromRGB(140, 80, 220)
		}):Play()

		if AdvGui then
			-- Staggered tab disappear animation
			local tabs = {}
			for _, child in ipairs(AdvTabStrip:GetChildren()) do
				if child:IsA("TextButton") then
					table.insert(tabs, child)
				end
			end
			for i = #tabs, 1, -1 do
				AnimateTabOut(tabs[i], (#tabs - i) * 0.05)
			end

			-- Slide DOWN animation (slight delay so tabs animate first)
			task.delay(0.15, function()
				AnimateAdvancedBar(AdvBar, false)
			end)

			-- Disconnect holographic if active
			if AdvancedModeConnection then
				AdvancedModeConnection:Disconnect()
				AdvancedModeConnection = nil
			end
		end

		-- Show normal window
		NormalWindowVisible = true
		Window.Visible = true
		Tween(Window, 0.3, { GroupTransparency = Setup.Transparency or 0 })
	end

	AdvButton.MouseButton1Click:Connect(function()
		if AdvModeActive then
			CloseAdvancedMode()
		else
			OpenAdvancedMode()
		end
	end)

	--// Animate (original window open/close)
	local Close = function()
		if Opened then
			if BlurEnabled then
				Blurs[Settings.Title].root.Parent = nil
			end
			Opened = false
			Animations:Close(Window)
			Window.Visible = false
		else
			Animations:Open(Window, Setup.Transparency)
			Opened = true
			if BlurEnabled then
				Blurs[Settings.Title].root.Parent = workspace.CurrentCamera
			end
		end
	end

	for Index, Button in next, Sidebar.Top.Buttons:GetChildren() do
		if Button:IsA("TextButton") then
			local Name = Button.Name
			if Name ~= "AdvancedMode" then
				Animations:Component(Button, true)
			end

			Connect(Button.MouseButton1Click, function()
				if Name == "Close" then
					Close()
				elseif Name == "Maximize" then
					if Maximized then
						Maximized = false
						Tween(Window, .15, { Size = Setup.Size });
					else
						Maximized = true
						Tween(Window, .15, { Size = UDim2.fromScale(1, 1), Position = UDim2.fromScale(0.5, 0.5) });
					end
				elseif Name == "Minimize" then
					Opened = false
					Window.Visible = false
					if BlurEnabled then Blurs[Settings.Title].root.Parent = nil end
				end
			end)
		end
	end

	Services.Input.InputBegan:Connect(function(Input, Focused)
		if (Input == Setup.Keybind or Input.KeyCode == Setup.Keybind) and not Focused then
			Close()
		end
	end)

	--// Tab Functions

	function Options:SetTab(Name: string)
		for Index, Button in next, Tab:GetChildren() do
			if Button:IsA("TextButton") then
				local Opened, SameName = Button.Value, (Button.Name == Name);
				local Padding = Button:FindFirstChildOfClass("UIPadding");

				if SameName and not Opened.Value then
					Tween(Padding, .25, { PaddingLeft = UDim.new(0, 25) });
					Tween(Button, .25, { BackgroundTransparency = 0.9, Size = UDim2.new(1, -15, 0, 30) });
					SetProperty(Opened, { Value = true });
				elseif not SameName and Opened.Value then
					Tween(Padding, .25, { PaddingLeft = UDim.new(0, 20) });
					Tween(Button, .25, { BackgroundTransparency = 1, Size = UDim2.new(1, -44, 0, 30) });
					SetProperty(Opened, { Value = false });
				end
			end
		end

		for Index, Main in next, Holder:GetChildren() do
			if Main:IsA("CanvasGroup") then
				local Opened, SameName = Main.Value, (Main.Name == Name);
				local Scroll = Main:FindFirstChild("ScrollingFrame");

				if SameName and not Opened.Value then
					Opened.Value = true
					Main.Visible = true
					Tween(Main, .3, { GroupTransparency = 0 });
					Tween(Scroll["UIPadding"], .3, { PaddingTop = UDim.new(0, 5) });
				elseif not SameName and Opened.Value then
					Opened.Value = false
					Tween(Main, .15, { GroupTransparency = 1 });
					Tween(Scroll["UIPadding"], .15, { PaddingTop = UDim.new(0, 15) });
					task.delay(.2, function()
						Main.Visible = false
					end)
				end
			end
		end
	end

	function Options:AddTabSection(Settings: { Name: string, Order: number })
		local Example = Examples["SectionExample"];
		local Section = Clone(Example);

		StoredInfo["Sections"][Settings.Name] = (Settings.Order);
		SetProperty(Section, {
			Parent = Example.Parent,
			Text = Settings.Name,
			Name = Settings.Name,
			LayoutOrder = Settings.Order,
			Visible = true
		});
	end

	function Options:AddTab(Settings: { Title: string, Icon: string, Section: string? })
		if StoredInfo["Tabs"][Settings.Title] then
			error("[UI LIB]: A tab with the same name has already been created")
		end

		local Example, MainExample = Examples["TabButtonExample"], Examples["MainExample"];
		local Section = StoredInfo["Sections"][Settings.Section];
		local Main = Clone(MainExample);
		local TabBtn = Clone(Example);

		if not Settings.Icon then
			Destroy(TabBtn["ICO"]);
		else
			SetProperty(TabBtn["ICO"], { Image = Settings.Icon });
		end

		StoredInfo["Tabs"][Settings.Title] = { TabBtn }
		SetProperty(TabBtn["TextLabel"], { Text = Settings.Title });

		SetProperty(Main, {
			Parent = MainExample.Parent,
			Name = Settings.Title;
		});

		SetProperty(TabBtn, {
			Parent = Example.Parent,
			LayoutOrder = Section or #StoredInfo["Sections"] + 1,
			Name = Settings.Title;
			Visible = true;
		});

		TabBtn.MouseButton1Click:Connect(function()
			Options:SetTab(TabBtn.Name);
		end)

		-- ── Also add a mirrored tab button to the Advanced Mode tab strip ──
		CreateAdvancedTab(Settings.Title)

		return Main.ScrollingFrame
	end

	--// Notifications
	function Options:Notify(Settings: { Title: string, Description: string, Duration: number })
		local Notification = Clone(Components["Notification"]);
		local Title, Description = Options:GetLabels(Notification);
		local Timer = Notification["Timer"];

		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Notification, { Parent = Screen["Frame"] })

		task.spawn(function()
			local Duration = Settings.Duration or 2
			local Wait = task.wait;

			Animations:Open(Notification, Setup.Transparency, true);
			Tween(Timer, Duration, { Size = UDim2.new(0, 0, 0, 4) });
			Wait(Duration);
			Animations:Close(Notification);
			Wait(1);
			Notification:Destroy();
		end)
	end

	--// Component Functions

	function Options:GetLabels(Component)
		local Labels = Component:FindFirstChild("Labels")
		return Labels.Title, Labels.Description
	end

	function Options:AddSection(Settings: { Name: string, Tab: Instance })
		local Section = Clone(Components["Section"]);
		SetProperty(Section, {
			Text = Settings.Name,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddButton(Settings: { Title: string, Description: string, Tab: Instance, Callback: any })
		local Button = Clone(Components["Button"]);
		local Title, Description = Options:GetLabels(Button);

		Connect(Button.MouseButton1Click, Settings.Callback)
		Animations:Component(Button)
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Button, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddInput(Settings: { Title: string, Description: string, Tab: Instance, Callback: any })
		local Input = Clone(Components["Input"]);
		local Title, Description = Options:GetLabels(Input);
		local TextBox = Input["Main"]["Input"];

		Connect(Input.MouseButton1Click, function()
			TextBox:CaptureFocus()
		end)

		Connect(TextBox.FocusLost, function()
			Settings.Callback(TextBox.Text)
		end)

		Animations:Component(Input)
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Input, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddToggle(Settings: { Title: string, Description: string, Default: boolean, Tab: Instance, Callback: any })
		local Toggle = Clone(Components["Toggle"]);
		local Title, Description = Options:GetLabels(Toggle);

		local On = Toggle["Value"];
		local Main = Toggle["Main"];
		local Circle = Main["Circle"];

		local Set = function(Value)
			if Value then
				Tween(Main, .2, { BackgroundColor3 = Color3.fromRGB(153, 155, 255) });
				Tween(Circle, .2, { BackgroundColor3 = Color3.fromRGB(255, 255, 255), Position = UDim2.new(1, -16, 0.5, 0) });
			else
				Tween(Main, .2, { BackgroundColor3 = Theme.Interactables });
				Tween(Circle, .2, { BackgroundColor3 = Theme.Primary, Position = UDim2.new(0, 3, 0.5, 0) });
			end
			On.Value = Value
		end

		Connect(Toggle.MouseButton1Click, function()
			local Value = not On.Value
			Set(Value)
			Settings.Callback(Value)
		end)

		Animations:Component(Toggle);
		Set(Settings.Default);
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Toggle, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddKeybind(Settings: { Title: string, Description: string, Tab: Instance, Callback: any })
		local Dropdown = Clone(Components["Keybind"]);
		local Title, Description = Options:GetLabels(Dropdown);
		local Bind = Dropdown["Main"].Options;

		local Mouse = { Enum.UserInputType.MouseButton1, Enum.UserInputType.MouseButton2, Enum.UserInputType.MouseButton3 };
		local Types = {
			["Mouse"] = "Enum.UserInputType.MouseButton",
			["Key"] = "Enum.KeyCode."
		}

		Connect(Dropdown.MouseButton1Click, function()
			local Time = tick();
			local Detect, Finished

			SetProperty(Bind, { Text = "..." });
			Detect = Connect(game.UserInputService.InputBegan, function(Key, Focused)
				local InputType = (Key.UserInputType);

				if not Finished and not Focused then
					Finished = (true)

					if table.find(Mouse, InputType) then
						Settings.Callback(Key);
						SetProperty(Bind, {
							Text = tostring(InputType):gsub(Types.Mouse, "MB")
						})
					elseif InputType == Enum.UserInputType.Keyboard then
						Settings.Callback(Key);
						SetProperty(Bind, {
							Text = tostring(Key.KeyCode):gsub(Types.Key, "")
						})
					end
				end
			end)
		end)

		Animations:Component(Dropdown);
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Dropdown, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddDropdown(Settings: { Title: string, Description: string, Options: {}, Tab: Instance, Callback: any })
		local Dropdown = Clone(Components["Dropdown"]);
		local Title, Description = Options:GetLabels(Dropdown);
		local Text = Dropdown["Main"].Options;

		Connect(Dropdown.MouseButton1Click, function()
			local Example = Clone(Examples["DropdownExample"]);
			local Buttons = Example["Top"]["Buttons"];

			Tween(BG, .25, { BackgroundTransparency = 0.6 });
			SetProperty(Example, { Parent = Window });
			Animations:Open(Example, 0, true)

			for Index, Button in next, Buttons:GetChildren() do
				if Button:IsA("TextButton") then
					Animations:Component(Button, true)
					Connect(Button.MouseButton1Click, function()
						Tween(BG, .25, { BackgroundTransparency = 1 });
						Animations:Close(Example);
						task.wait(2)
						Destroy(Example);
					end)
				end
			end

			for Index, Option in next, Settings.Options do
				local Button = Clone(Examples["DropdownButtonExample"]);
				local Title, Description = Options:GetLabels(Button);
				local Selected = Button["Value"];

				Animations:Component(Button);
				SetProperty(Title, { Text = Index });
				SetProperty(Button, { Parent = Example.ScrollingFrame, Visible = true });
				Destroy(Description);

				Connect(Button.MouseButton1Click, function()
					local NewValue = not Selected.Value

					if NewValue then
						Tween(Button, .25, { BackgroundColor3 = Theme.Interactables });
						Settings.Callback(Option)
						Text.Text = Index

						for _, Others in next, Example:GetChildren() do
							if Others:IsA("TextButton") and Others ~= Button then
								Others.BackgroundColor3 = Theme.Component
							end
						end
					else
						Tween(Button, .25, { BackgroundColor3 = Theme.Component });
					end

					Selected.Value = NewValue
					Tween(BG, .25, { BackgroundTransparency = 1 });
					Animations:Close(Example);
					task.wait(2)
					Destroy(Example);
				end)
			end
		end)

		Animations:Component(Dropdown);
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Dropdown, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddSlider(Settings: { Title: string, Description: string, MaxValue: number, AllowDecimals: boolean, DecimalAmount: number, Tab: Instance, Callback: any })
		local Slider = Clone(Components["Slider"]);
		local Title, Description = Options:GetLabels(Slider);

		local Main = Slider["Slider"];
		local Amount = Main["Main"].Input;
		local Slide = Main["Slide"];
		local Fire = Slide["Fire"];
		local Fill = Slide["Highlight"];
		local Circle = Fill["Circle"];

		local Active = false
		local Value = 0

		local SetNumber = function(Number)
			if Settings.AllowDecimals then
				local Power = 10 ^ (Settings.DecimalAmount or 2)
				Number = math.floor(Number * Power + 0.5) / Power
			else
				Number = math.round(Number)
			end
			return Number
		end

		local Update = function(Number)
			local Scale = (Player.Mouse.X - Slide.AbsolutePosition.X) / Slide.AbsoluteSize.X
			Scale = (Scale > 1 and 1) or (Scale < 0 and 0) or Scale

			if Number then
				Number = (Number > Settings.MaxValue and Settings.MaxValue) or (Number < 0 and 0) or Number
			end

			Value = SetNumber(Number or (Scale * Settings.MaxValue))
			Amount.Text = Value
			Fill.Size = UDim2.fromScale((Number and Number / Settings.MaxValue) or Scale, 1)
			Settings.Callback(Value)
		end

		local Activate = function()
			Active = true
			repeat task.wait()
				Update()
			until not Active
		end

		Connect(Amount.FocusLost, function()
			Update(tonumber(Amount.Text) or 0)
		end)

		Connect(Fire.MouseButton1Down, Activate)
		Connect(Services.Input.InputEnded, function(Input)
			if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
				Active = false
			end
		end)

		Fill.Size = UDim2.fromScale(Value, 1);
		Animations:Component(Slider);
		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Slider, {
			Name = Settings.Title,
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	function Options:AddParagraph(Settings: { Title: string, Description: string, Tab: Instance })
		local Paragraph = Clone(Components["Paragraph"]);
		local Title, Description = Options:GetLabels(Paragraph);

		SetProperty(Title, { Text = Settings.Title });
		SetProperty(Description, { Text = Settings.Description });
		SetProperty(Paragraph, {
			Parent = Settings.Tab,
			Visible = true,
		})
	end

	--// ============================================================
	--// THEME SYSTEM (Solid / Gradient / Holographic)
	--// ============================================================

	-- Apply gradient UIGradient to a frame
	local function ApplyGradientToFrame(frame, color1, color2, rotation)
		local existing = frame:FindFirstChildOfClass("UIGradient")
		if existing then existing:Destroy() end

		local grad = Instance.new("UIGradient")
		grad.Color = ColorSequence.new({
			ColorSequenceKeypoint.new(0, color1),
			ColorSequenceKeypoint.new(1, color2),
		})
		grad.Rotation = rotation or GradientConfig.Rotation
		grad.Parent = frame
	end

	-- Remove any UIGradient from a frame
	local function RemoveGradient(frame)
		local existing = frame:FindFirstChildOfClass("UIGradient")
		if existing then existing:Destroy() end
	end

	-- Apply holographic shimmer to a frame (replaces gradient with animated rainbow)
	local function ApplyHoloToFrame(frame)
		RemoveGradient(frame)
		local conn = ApplyHolographicToFrame(frame)
		table.insert(HoloConnections, conn)
	end

	-- Clear all holographic connections
	local function ClearHoloConnections()
		for _, conn in ipairs(HoloConnections) do
			if conn then conn:Disconnect() end
		end
		HoloConnections = {}
	end

	-- Master function: apply the current ThemeType across the main window + advanced bar
	function Options:ApplyThemeToWindow()
		ClearHoloConnections()

		if ThemeType == "Gradient" then
			-- Main window frames
			ApplyGradientToFrame(Window, GradientConfig.Color1, GradientConfig.Color2, GradientConfig.Rotation)
			ApplyGradientToFrame(Holder, GradientConfig.Color1, GradientConfig.Color2, GradientConfig.Rotation)

			-- Sidebar
			local sidebar = Window:FindFirstChild("Sidebar")
			if sidebar then
				ApplyGradientToFrame(sidebar, GradientConfig.Color1, GradientConfig.Color2, GradientConfig.Rotation + 90)
			end

		elseif ThemeType == "Holographic" then
			ApplyHoloToFrame(Window)
			ApplyHoloToFrame(Holder)

			local sidebar = Window:FindFirstChild("Sidebar")
			if sidebar then ApplyHoloToFrame(sidebar) end

		else -- "Solid"
			RemoveGradient(Window)
			RemoveGradient(Holder)
			local sidebar = Window:FindFirstChild("Sidebar")
			if sidebar then RemoveGradient(sidebar) end
		end
	end

	-- Apply theme to the Advanced Mode bar specifically
	function Options:ApplyThemeToAdvBar()
		if not AdvBar then return end

		ClearHoloConnections()

		if ThemeType == "Gradient" then
			ApplyGradientToFrame(AdvBar, GradientConfig.Color1, GradientConfig.Color2, GradientConfig.Rotation)

			-- Also tint each tab
			if AdvTabStrip then
				for _, child in ipairs(AdvTabStrip:GetChildren()) do
					if child:IsA("TextButton") then
						ApplyGradientToFrame(child, GradientConfig.Color1, GradientConfig.Color2, GradientConfig.Rotation + 45)
					end
				end
			end

		elseif ThemeType == "Holographic" then
			ApplyHoloToFrame(AdvBar)

			if AdvTabStrip then
				for _, child in ipairs(AdvTabStrip:GetChildren()) do
					if child:IsA("TextButton") then
						ApplyHoloToFrame(child)
					end
				end
			end

		else -- Solid
			RemoveGradient(AdvBar)
			if AdvTabStrip then
				for _, child in ipairs(AdvTabStrip:GetChildren()) do
					if child:IsA("TextButton") then
						RemoveGradient(child)
					end
				end
			end
		end
	end

	-- Combined: apply theme everywhere
	function Options:ApplyTheme()
		Options:ApplyThemeToWindow()
		if AdvModeActive then
			Options:ApplyThemeToAdvBar()
		end
	end

	--// Existing SetTheme (solid color theme tables)
	local Themes = {
		Names = {
			["Paragraph"] = function(Label)
				if Label:IsA("TextButton") then
					Label.BackgroundColor3 = Color(Theme.Component, 5, "Dark");
				end
			end,
			["Title"] = function(Label)
				if Label:IsA("TextLabel") then
					Label.TextColor3 = Theme.Title
				end
			end,
			["Description"] = function(Label)
				if Label:IsA("TextLabel") then
					Label.TextColor3 = Theme.Description
				end
			end,
			["Section"] = function(Label)
				if Label:IsA("TextLabel") then
					Label.TextColor3 = Theme.Title
				end
			end,
			["Options"] = function(Label)
				if Label:IsA("TextLabel") and Label.Parent.Name == "Main" then
					Label.TextColor3 = Theme.Title
				end
			end,
			["Notification"] = function(Label)
				if Label:IsA("CanvasGroup") then
					Label.BackgroundColor3 = Theme.Primary
					Label.UIStroke.Color = Theme.Outline
				end
			end,
			["TextLabel"] = function(Label)
				if Label:IsA("TextLabel") and Label.Parent:FindFirstChild("List") then
					Label.TextColor3 = Theme.Tab
				end
			end,
			["Main"] = function(Label)
				if Label:IsA("Frame") then
					if Label.Parent == Window then
						Label.BackgroundColor3 = Theme.Secondary
					elseif Label.Parent:FindFirstChild("Value") then
						local Toggle = Label.Parent.Value
						if not Toggle.Value then
							Label.BackgroundColor3 = Theme.Interactables
							Label.Circle.BackgroundColor3 = Theme.Primary
						end
					else
						Label.BackgroundColor3 = Theme.Interactables
					end
				elseif Label:FindFirstChild("Padding") then
					Label.TextColor3 = Theme.Title
				end
			end,
			["Amount"] = function(Label)
				if Label:IsA("Frame") then
					Label.BackgroundColor3 = Theme.Interactables
				end
			end,
			["Slide"] = function(Label)
				if Label:IsA("Frame") then
					Label.BackgroundColor3 = Theme.Interactables
				end
			end,
			["Input"] = function(Label)
				if Label:IsA("TextLabel") then
					Label.TextColor3 = Theme.Title
				elseif Label:FindFirstChild("Labels") then
					Label.BackgroundColor3 = Theme.Component
				elseif Label:IsA("TextBox") and Label.Parent.Name == "Main" then
					Label.TextColor3 = Theme.Title
				end
			end,
			["Outline"] = function(Stroke)
				if Stroke:IsA("UIStroke") then
					Stroke.Color = Theme.Outline
				end
			end,
			["DropdownExample"] = function(Label)
				Label.BackgroundColor3 = Theme.Secondary
			end,
			["Underline"] = function(Label)
				if Label:IsA("Frame") then
					Label.BackgroundColor3 = Theme.Outline
				end
			end,
		},
		Classes = {
			["ImageLabel"] = function(Label)
				if Label.Image ~= "rbxassetid://6644618143" then
					Label.ImageColor3 = Theme.Icon
				end
			end,
			["TextLabel"] = function(Label)
				if Label:FindFirstChild("Padding") then
					Label.TextColor3 = Theme.Title
				end
			end,
			["TextButton"] = function(Label)
				if Label:FindFirstChild("Labels") then
					Label.BackgroundColor3 = Theme.Component
				end
			end,
			["ScrollingFrame"] = function(Label)
				Label.ScrollBarImageColor3 = Theme.Component
			end,
		},
	}

	function Options:SetTheme(Info)
		Theme = Info or Theme

		Window.BackgroundColor3 = Theme.Primary
		Holder.BackgroundColor3 = Theme.Secondary
		Window.UIStroke.Color = Theme.Shadow

		for Index, Descendant in next, Screen:GetDescendants() do
			local Name, Class = Themes.Names[Descendant.Name], Themes.Classes[Descendant.ClassName]
			if Name then
				Name(Descendant);
			elseif Class then
				Class(Descendant);
			end
		end

		-- Re-apply gradient / holographic on top of solid theme
		Options:ApplyTheme()
	end

	--// ============================================================
	--// SET THEME TYPE (public API)
	--// Call Options:SetThemeType("Gradient") / "Holographic" / "Solid"
	--// ============================================================
	function Options:SetThemeType(newType, config)
		ThemeType = newType or "Solid"
		if config then
			if config.Color1 then GradientConfig.Color1 = config.Color1 end
			if config.Color2 then GradientConfig.Color2 = config.Color2 end
			if config.Rotation then GradientConfig.Rotation = config.Rotation end
		end
		Options:ApplyTheme()
	end

	--// Changing Settings

	function Options:SetSetting(Setting, Value)
		if Setting == "Size" then
			Window.Size = Value
			Setup.Size = Value
		elseif Setting == "Transparency" then
			Window.GroupTransparency = Value
			Setup.Transparency = Value
			for Index, Notification in next, Screen:GetDescendants() do
				if Notification:IsA("CanvasGroup") and Notification.Name == "Notification" then
					Notification.GroupTransparency = Value
				end
			end
		elseif Setting == "Blur" then
			local AlreadyBlurred, Root = Blurs[Settings.Title], nil
			if AlreadyBlurred then
				Root = Blurs[Settings.Title]["root"]
			end
			if Value then
				BlurEnabled = true
				if not AlreadyBlurred or not Root then
					Blurs[Settings.Title] = Blur.new(Window, 5)
				elseif Root and not Root.Parent then
					Root.Parent = workspace.CurrentCamera
				end
			elseif not Value and (AlreadyBlurred and Root and Root.Parent) then
				Root.Parent = nil
				BlurEnabled = false
			end
		elseif Setting == "Theme" and typeof(Value) == "table" then
			Options:SetTheme(Value)
		elseif Setting == "Keybind" then
			Setup.Keybind = Value
		elseif Setting == "ThemeType" then
			-- Value should be "Solid", "Gradient", or "Holographic"
			Options:SetThemeType(Value)
		else
			warn("Tried to change a setting that doesn't exist or isn't available to change.")
		end
	end

	--// ── Advanced Mode helpers exposed on Options ──
	function Options:OpenAdvancedMode()
		OpenAdvancedMode()
	end

	function Options:CloseAdvancedMode()
		CloseAdvancedMode()
	end

	function Options:IsAdvancedModeOpen()
		return AdvModeActive
	end

	-- Get the Script Name / Author TextBoxes (so users can pre-fill them)
	function Options:GetAdvancedFields()
		if AdvGui then
			return AdvScriptName, AdvAuthor
		end
		return nil, nil
	end

	--// Initial setup
	SetProperty(Window, { Size = Settings.Size, Visible = true, Parent = Screen });
	Animations:Open(Window, Settings.Transparency or 0)

	-- Apply initial theme type
	task.defer(function()
		Options:ApplyTheme()
	end)

	return Options
end

return Library
